<!DOCTYPE html>
<html>

<head>
    <title>百ます計算</title>
    <style>
        td {
            border: 1px solid black;
            width: 50px;
            height: 50px;
            text-align: center;
        }

        h2 {
            margin: 1px 3px;
        }

        p {
            margin: 1px 3px;
        }

        #setsumei {
            margin-bottom: 10px;
        }

        input {
            width: 40px;
            height: 40px;
            text-align: center;
            font-size: 30px;
        }

        #time {
            padding: 250px 200px;
        }

        main {
            display: flex;
        }

        #kotae {
            font-size: 50px;
        }
    </style>
</head>

<body>
    <!--説明-->
    <div id="setsumei">
        <h2>説明</h2>
        <p>これは百ます計算（かけ算）です。</p>
        <p>"スタート"ボタンを押すとタイマーが始まります。</p>
        <p>"答え合わせ"ボタンを押すと答えが表示され、タイマーがストップします。</p>
        <p>答えを表示したときの<span style="color:blue;">青い文字</span>は正解、<span style="color:red;">赤い文字</span>は不正解です。</p>
        <p>ブラウザを再読み込みすると、新しい問題が出ます。</p>
    </div>

    <button id="start">スタート</button>

    <main>
        <!--百ます計算の表-->
        <table id="hyakumasu"></table>
        <h1 id="time"></h1>
    </main>

    <button id="kotae">答え合わせ</button>

    <!--script-->
    <script>
        // table
        const table = document.getElementById("hyakumasu");

        let time = 0;
        let sec = 0;
        let min = 0;
        let hour = 0;
        let day = 0;
        let week = 0;
        let timer;
        const timeElement = document.getElementById("time");

        // 要素の追加
        for (let y = 0; y < 11; y++) {
            const tr = document.createElement("tr");
            table.appendChild(tr);

            for (let x = 0; x < 11; x++) {
                const td = document.createElement("td");
                td.id = `${x}${y}`;
                tr.appendChild(td);

                if (x > 0 && y > 0) {
                    const input = document.createElement("input");
                    input.type = "text";
                    td.appendChild(input);
                }
            }
        }

        document.getElementById("00").textContent = "×"

        // 左と上の数字
        let topRandomNums = [];
        for (let i = 1; i < 11; i++) {
            let random;

            while (true) {
                random = Math.floor(Math.random() * 10);
                if (!topRandomNums.includes(random)) {
                    topRandomNums.push(random);
                    break;
                }
            }
            document.getElementById(`${i}0`).textContent = random;
        }

        let leftRandomNums = [];
        for (let i = 1; i < 11; i++) {
            let random;

            while (true) {
                random = Math.floor(Math.random() * 10);
                if (!leftRandomNums.includes(random)) {
                    leftRandomNums.push(random);
                    break;
                }
            }
            document.getElementById(`0${i}`).textContent = random;
        }

        // 答えの表示
        function showKotae() {
            for (let y = 1; y < 11; y++) {
                for (let x = 1; x < 11; x++) {
                    const target = document.getElementById(`${x}${y}`);

                    const top = Number(document.getElementById(`${x}0`).textContent);
                    const left = Number(document.getElementById(`0${y}`).textContent);

                    if (target.firstElementChild.value != "" && Number(target.firstElementChild.value) == top * left) {
                        target.style = "color:blue;font-size: 30px;";
                    } else {
                        target.style = "color:red;font-size: 30px;";
                    }

                    target.textContent = top * left;
                }
            }

            // タイマー停止
            clearInterval(timer);
        }

        document.getElementById("kotae").addEventListener("click", showKotae);

        // タイマー
        function updateTime() {
            time += 0.1;
            sec = time % 60;
            min = Math.floor(time % 3600 / 60);
            if(min >= 60)
                min = 0;
            hour = Math.floor(time % 86400 / 3600);
            if(hour >= 60)
                hour = 0;
            day = Math.floor(time % 611200 / 86400);
            if(day >= 60)
                day = 0;
            week = Math.floor(time / 611200);
            timeElement.textContent = `${week}week：${day}day：${hour}：${min}：${sec.toFixed(1)}`;
        }

        document.getElementById("start").addEventListener("click", function () {
            timer = setInterval(updateTime, 0.1);
        })
    </script>
</body>

</html>